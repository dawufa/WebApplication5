<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: 'Arial', sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
    }

    .image-container {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    .full-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 2.65s ease;
      z-index: 2;
    }

    .full-image.hidden {
      opacity: 0;
    }

    .flip-strips {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
    }

    .flip-strip {
      position: absolute;
      height: 100%;
      perspective: 800px;
      overflow: hidden;
    }

    .flip-inner {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      transform-style: preserve-3d;
      transition: transform 5s cubic-bezier(0.4,0,0.2,1);
      transform: rotateY(0deg);
    }

    .flip-strip.flipping .flip-inner {
      transform: rotateY(180deg) !important;
    }

    .flip-face {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      backface-visibility: hidden;
      overflow: hidden;
      background: #000;
    }

    .flip-face.front img,
    .flip-face.back img {
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
    }

    .flip-face.back {
      transform: rotateY(180deg);
    }

    @media (max-width: 500px) {
      html, body,
      .container,
      .image-container {
        height: 90vh;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="image-container" id="horizontalContainer">
      <img class="full-image" id="horizontalFullImage"
        src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Eggyolkcake/horizontal01.jpg" />
      <div class="flip-strips" id="horizontalFlipStrips"></div>
    </div>
  </div>

  <script>
    const horizontalImages = [
      'https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Eggyolkcake/horizontal01.jpg',
      'https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Eggyolkcake/horizontal01.jpg'
    ];
    const splitXs = [0, 0, 153, 695, 1255, 1805, 2365, 2905, 3470, 4025, 4575, 5130, 5695, 6255];
    const originalWidth = 6400;
    const stripCount = splitXs.length;
    let horizontalIndex = 0;

    function initializeStrips() {
      const container = document.getElementById('horizontalContainer');
      const containerW = container.offsetWidth;
      const scale = containerW / originalWidth;

      const horizontalFlipStrips = document.getElementById('horizontalFlipStrips');
      horizontalFlipStrips.innerHTML = '';

      for (let i = 0; i < stripCount; i++) {
        const strip = document.createElement('div');
        strip.className = 'flip-strip';

        const left = (i === 0) ? 0 : splitXs[i] * scale;
        const width = (i === stripCount - 1)
          ? containerW - left
          : (splitXs[i + 1] - splitXs[i]) * scale;

        Object.assign(strip.style, {
          left: `${left}px`,
          width: `${width}px`,
        });

        const inner = document.createElement('div');
        inner.className = 'flip-inner';

        const front = document.createElement('div');
        front.className = 'flip-face front';
        const frontImg = document.createElement('img');
        frontImg.src = horizontalImages[horizontalIndex];
        frontImg.style.left = `${-splitXs[i] * scale}px`;
        frontImg.style.width = `${containerW}px`;
        front.appendChild(frontImg);

        const back = document.createElement('div');
        back.className = 'flip-face back';

        inner.appendChild(front);
        inner.appendChild(back);
        strip.appendChild(inner);
        horizontalFlipStrips.appendChild(strip);
      }
    }

    function nextImage() {
      const fullImage = document.getElementById('horizontalFullImage');
      const flipStrips = document.getElementById('horizontalFlipStrips');
      const nextIdx = (horizontalIndex + 1) % horizontalImages.length;
      const container = document.getElementById('horizontalContainer');
      const containerW = container.offsetWidth;
      const scale = containerW / originalWidth;

      fullImage.classList.add('hidden');

      const strips = flipStrips.querySelectorAll('.flip-strip');

      strips.forEach((strip, idx) => {
        setTimeout(() => {
          strip.classList.add('flipping');
          const inner = strip.querySelector('.flip-inner');
          inner.style.transform = 'rotateY(180deg)';

          setTimeout(() => {
            const back = strip.querySelector('.flip-face.back');
            back.innerHTML = '';
            const backImg = document.createElement('img');
            backImg.src = horizontalImages[nextIdx];
            backImg.style.left = `${-splitXs[idx] * scale}px`;
            backImg.style.width = `${containerW}px`;
            back.appendChild(backImg);
          }, 800);
        }, idx * 300);
      });

      setTimeout(() => {
        horizontalIndex = nextIdx;
        fullImage.src = horizontalImages[horizontalIndex];
        fullImage.classList.remove('hidden');

        strips.forEach((strip) => {
          strip.classList.remove('flipping');
          const inner = strip.querySelector('.flip-inner');
          inner.style.transition = 'none';
          inner.style.transform = 'rotateY(0deg)';
          void inner.offsetHeight;
          inner.style.transition = '';
        });
      }, stripCount * 300 + 1800);
    }

    function startAutoPlay() {
      setInterval(nextImage, 15000);
    }

    window.addEventListener('load', () => {
      initializeStrips();
      setTimeout(nextImage, 1000);
      startAutoPlay();
    });

    // ✅ 響應式處理：當畫面尺寸改變時重新建立切割條
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        initializeStrips();
      }, 200); // debounce
    });
  </script>
</body>
</html>
