<style>

    .main-content {
        max-width: 100vw;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        min-height: 125vh;
        padding-top: 5vw;
        background-image: url('https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/BG_02.png');
        background-size: 200% auto;
        background-position: center center;
        background-repeat: no-repeat;
        margin: 0;
        padding: 0;
        height: 100vh;
    }

.carousel-wrapper {
    position: relative;
    width: 90vw;
    max-width: 1200px;
    height: 50vw;
    max-height: 750px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 0;
}

.carousel {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
}

.carousel img {
    position: absolute;
    max-width: 100%;
    max-height: 87.5%;
    width: auto;
    height: auto;
    transition: transform 0.6s, opacity 0.6s;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    transform-style: preserve-3d;
}

.carousel-wrapper button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 10;
    padding: 0;
}

#lastone {
    left: 4vw;
}

#nextone {
    right: 4vw;
}

.carousel-wrapper button img {
    width: 4vw;
    max-width: 48px;
    min-width: 28px;
    height: auto;
    opacity: 0.7;
    transition: opacity 0.3s;
}

.carousel-wrapper button img:hover {
    opacity: 1;
}

.title-img-left {
    position: absolute;
    top: 5vw;
    left: 2vw;
    max-width: 20vw;
    min-width: 60px;
    height: auto;
    z-index: 999;
    pointer-events: none;
}

.title-img-right {
    position: absolute;
    top: 1vw;
    right: 1vw;
    max-width: 35vw;
    min-width: 90px;
    height: auto;
    z-index: 999;
    pointer-events: none;
}

.bottom-area {
    width: 90vw;
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
    position: relative;
    z-index: 999;
    margin-top: 2vw;
}

.title-img-bottom {
    max-width: 65vw;
    min-width: 120px;
    width: 100%;
    height: auto;
}

.bottom-buttons {
    margin-top: 1vw;
    display: flex;
    justify-content: center;
    gap: 2vw;
}

.bottom-buttons button {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
}

.bottom-buttons button img {
    width: 25vw;
    max-width: 75px;
    min-width: 18px;
    height: auto;
    opacity: 0.8;
    transition: opacity 0.3s;
}

.bottom-buttons button img:hover {
    opacity: 1;
}


/* 手機 */
@media (max-width: 900px) {
  .main-content{
        max-width: 900px; /* 強制維持版面完整顯示 */
        width: 100%;
        height: auto; /* 改為自動高度，不要固定高度 */
        min-height: auto; /* 移除最小高度限制 */
        margin: 0;
        padding: 0;
        align-items: center;
        position: relative;
        background-image: url('https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/BG_02.png');
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
    }

    #lastone {
        left: 0.5vw;
    }

    #nextone {
        right: 0.5vw;
    }

    .bottom-area {
        width: 90vw;
        max-width: 90vw;
        margin-top: 1vw;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .bottom-buttons {
        gap: 2vw;
        margin-top: 0.5vw;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .bottom-buttons button {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
    }

    .bottom-buttons button img {
        width: 4vw;
        max-width: 20px;
        min-width: 8px;
    }
}
/* 手機 */
@media (max-width: 500px) {
  .main-content{
        max-width: 500px; /* 強制維持版面完整顯示 */
        width: 100%;
        height: auto; /* 改為自動高度，不要固定高度 */
        min-height: auto; /* 移除最小高度限制 */
        margin: 0;
        padding: 0;
        align-items: center;
        position: relative;
        background-image: url('https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/BG_02.png');
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
    }

    #lastone {
        left: 0.5vw;
    }

    #nextone {
        right: 0.5vw;
    }

    .bottom-area {
        width: 90vw;
        max-width: 90vw;
        margin-top: 1vw;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .bottom-buttons {
        gap: 2vw;
        margin-top: 0.5vw;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .bottom-buttons button {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
    }

    .bottom-buttons button img {
        width: 4vw;
        max-width: 20px;
        min-width: 8px;
    }
}


</style>

<div class="main-content">
    <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Buttons/Title01.png" class="title-img-left" />
    <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Buttons/Title02.png" class="title-img-right" />

    <body>
        <div class="carousel-wrapper">
            <div class="carousel" id="carousel">
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F01.png" class="carousel-img" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F02.png" class="carousel-img" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F03.png" class="carousel-img" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F04.png" class="carousel-img" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F05.png" class="carousel-img" />

                <!-- 第二組透明 -->
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F01.png" class="carousel-img" style="opacity: 0;" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F02.png" class="carousel-img" style="opacity: 0;" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F03.png" class="carousel-img" style="opacity: 0;" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F04.png" class="carousel-img" style="opacity: 0;" />
                <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Pineapple/PA_F05.png" class="carousel-img" style="opacity: 0;" />
            </div>
        </div>
        <div class="bottom-area">
            <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Buttons/Title03.png" class="title-img-bottom" />
            <div class="bottom-buttons">
                <button id="lastone">
                    <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Buttons/LWS_B.png" />
                </button>
                <button id="nextone">
                    <img src="https://dawufa.github.io/WebApplication5/WebApplication5/IMAGES/Buttons/RWS_B.png" />
                </button>
            </div>
        </div>
        <script>
            const track = document.getElementById('carousel');
            const imgs = Array.from(track.children);
            const totalImgs = imgs.length; // 10
            const visibleCount = 5;
            let currentStartIndex = 0;
            let isAnimating = false;
            let isFirstRender = true; // 是否為第一次渲染

            function updateCarousel() {
                // 根據視窗大小動態調整參數
                const windowWidth = window.innerWidth;
                let radius, angleStep, scaleStep, yAmplitude, skewAngle;

                if (windowWidth > 900) {
                    // 桌面版
                    radius = 900;
                    angleStep = Math.PI / 6;
                    scaleStep = 0.08;
                    yAmplitude = 100;
                    skewAngle = 10;
                } else if (windowWidth > 600) {
                    // 平板版
                    radius = 300;
                    angleStep = Math.PI / 6;
                    scaleStep = 0.1;
                    yAmplitude = 80;
                    skewAngle = 8;
                } else {
                    // 手機版
                    radius = 200;
                    angleStep = Math.PI / 8;
                    scaleStep = 0.08;
                    yAmplitude = 60;
                    skewAngle = 6;
                }

                const transitionTime = 600; // 與 CSS transform 過渡時間一致

                imgs.forEach((img, i) => {
                    const relativeIndex = (i - currentStartIndex + totalImgs) % totalImgs;

                    if (relativeIndex < visibleCount) {
                        const baseIndex = relativeIndex - 2;
                        const angle = baseIndex * angleStep;
                        const x = Math.sin(angle) * radius;
                        const z = -Math.abs(Math.cos(angle) * radius);
                        const y = Math.cos(angle) * yAmplitude - yAmplitude;
                        const scale = 1 - Math.abs(baseIndex) * scaleStep;

                        let rotateY;
                        if (relativeIndex === 0) {
                            rotateY = -(-1 * angleStep) * (180 / Math.PI);
                        } else if (relativeIndex === visibleCount - 1) {
                            rotateY = -(1 * angleStep) * (180 / Math.PI);
                        } else {
                            rotateY = -angle * (180 / Math.PI);
                        }

                        let skewYAngle = 0;
                        if (baseIndex < 0) {
                            skewYAngle = -skewAngle;
                        } else if (baseIndex > 0) {
                            skewYAngle = skewAngle;
                        }

                        const baseTransform = `
                           translateX(${x}px)
                           translateY(${y}px)
                           translateZ(${-z}px)
                           scale(${scale})
                           rotateY(${rotateY}deg)
                           skewY(${skewYAngle}deg)
                       `;
                        img.dataset.baseTransform = baseTransform;
                        img.style.transition = `transform ${transitionTime}ms ease-in-out`;
                        img.style.opacity = 1;
                        img.style.zIndex = 100 - Math.abs(baseIndex);
                        img.style.transform = baseTransform;


                    } else {
                        img.style.opacity = 0;
                        img.style.zIndex = 0;
                        img.style.transform = 'translateZ(-2000px) scale(0.5)';
                    }
                });
                if (isFirstRender == false) {
                    setTimeout(() => {
                        const centerImg = imgs[(currentStartIndex + 2) % totalImgs];
                        bounceImage(centerImg);
                    }, transitionTime);
                } // 第一次渲染之後改為 false
                // 延遲觸發中間圖片的彈跳動畫


            }

            function bounceImage(img) {
                let start = null;
                const duration = 400;
                const peakY = -400;
                const peakZ = 50;
                const peakScale = 20; // 放大 1.2 倍

                function animateBounce(timestamp) {
                    if (!start) start = timestamp;
                    const progress = (timestamp - start) / duration;
                    let t = progress > 1 ? 1 : progress;
                    const bounce = Math.sin(t * Math.PI);

                    const translateY = bounce * peakY;
                    const translateZ = bounce * peakZ;

                    const scale = 1 + (peakScale - 1) * bounce; // 從 1 放大到 1.2 再回來
                    // 將彈跳疊加到原本 transform

                    img.style.transform = `${img.dataset.baseTransform} scale(${scale}) translateY(${translateY}px) translateZ(${translateZ}px)`;

                    if (progress < 1) {
                        requestAnimationFrame(animateBounce);
                    }
                }

                requestAnimationFrame(animateBounce);
            }

            function handleNext() {
                if (isAnimating) return;
                isAnimating = true;

                currentStartIndex = (currentStartIndex + 1) % totalImgs;
                isFirstRender = false;
                updateCarousel();

                setTimeout(() => isAnimating = false, 600);
            }

            function handlePrev() {
                if (isAnimating) return;
                isAnimating = true;

                currentStartIndex = (currentStartIndex - 1 + totalImgs) % totalImgs;
                isFirstRender = false;
                updateCarousel();

                setTimeout(() => isAnimating = false, 600);
            }

            document.getElementById('nextone').addEventListener('click', handleNext);
            document.getElementById('lastone').addEventListener('click', handlePrev);

            updateCarousel();

            // 監聽視窗大小變化，重新計算輪播
            window.addEventListener('resize', () => {
                if (!isAnimating) {
                    updateCarousel();
                }
            });
        </script>
    </body>

